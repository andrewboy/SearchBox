!function(e){"use strict";var t=function(a,r,o){var s,n=this,l=function(t){switch(t){case"operatorSelect":return e(".operators",s);case"filterVal1":return e(".filter-value-1",s);case"filterVal2":return e(".filter-value-2",s);case"listToggleBtn":return e(".list-toggle",s);case"checkBox":return e("input.icheck",s)}},i=function(t){var a=e(t.currentTarget);switch(a.val()){case"=":case">=":case"<=":case"!":l("filterVal1").css("display","block").attr("disabled",!1),l("filterVal2").css("display","none").attr("disabled",!0);break;case"><":l("filterVal1").css("display","block").attr("disabled",!1),l("filterVal2").css("display","block").attr("disabled",!1)}},c=function(e){var t=l("filterVal1");e?(t.attr("size",4).attr("multiple",!0),l("listToggleBtn").addClass("btn-danger").removeClass("btn-primary").children().removeClass("fa-plus").addClass("fa-minus")):(t.attr("size",1).attr("multiple",!1),l("listToggleBtn").removeClass("btn-danger").addClass("btn-primary").children().removeClass("fa-minus").addClass("fa-plus"))},u=function(){c(!l("filterVal1").is("[multiple]"))},d=function(){s=e(t.getTemplate("layout",[r,o,a.getSettings("itemLabels"),a.getSettings("itemOperators")])),a.addItem(n),l("checkBox").iCheck("destroy").iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square"}),l("listToggleBtn").on("click",u),l("operatorSelect").on("change",i),l("operatorSelect").change()};this.destroy=function(){s.remove(),o=void 0,a.removeItem(r)},this.getElement=function(){return s},this.getId=function(){return r},this.setOperator=function(e){l("operatorSelect").children('[value="'+e+'"]').prop("selected","selected").trigger("change")},this.setValues=function(e){"list"===o.type&&e.length>1?(c(!0),l("filterVal1").val(e)):(l("filterVal1").val(e[0]),e.length>1&&l("filterVal2").val(e[1]))},this.setVisible=function(e){e?s.removeClass("hidden"):s.addClass("hidden")},this.setChecked=function(e){e?l("checkBox").iCheck("check"):l("checkBox").iCheck("uncheck")},d()};t.getTemplate=function(e,a){var r={};return r.layout=function(e,a,r,o){var s='<div class="row">';return s+=t.getTemplate("checkboxLayout",[e]),s+=t.getTemplate("labelLayout",[e,r]),s+=t.getTemplate("operatorListLayout",[e,a,o]),s+=t.getTemplate("valuesLayout",[e,a]),s+="</div>"},r.valuesLayout=function(e,t){var a,r="";if(r+='<div class="row col-md-7">',"list"===t.type){r+='<div class="form-group col-md-4">',r+='<select name="search['+e+'][values][]" class="form-control input-block-level filter-value-1" size="1">';for(a in t.values)t.values.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+t.values[a]+"</option>");r+="</select>",r+="</div>",r+='<div class="form-group col-md-2"><button type="button" class="btn btn-sm btn-primary glyphicon list-toggle"><i class="fa fa-plus"></i></button></div>'}else"boolean"===t.type?r+='<div class="form-group col-md-4"><input type="hidden" value="1" name="search['+e+'][values][]" /></div>':(r+='<div class="form-group col-md-4"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-1" '+("date"===t.type?'data-provide="datepicker" data-date-format="yyyy-mm-dd"':"")+" /></div>",["date","integer"].indexOf(t.type)>-1&&(r+='<div class="form-group col-md-4"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-2" '+("date"===t.type?'data-provide="datepicker"  data-date-format="yyyy-mm-dd"':"")+" /></div>"));return r+="</div>"},r.operatorListLayout=function(e,a,r){var o,s;o='<div class="form-group col-md-2"><select name="search['+e+'][operator]" class="form-control  input-block-level operators">';for(s in t.operatorByType[a.type])t.operatorByType[a.type].hasOwnProperty(s)&&(o+='<option value="'+t.operatorByType[a.type][s]+'">'+r[t.operatorByType[a.type][s]]+"</option>");return o+="</select></div>"},r.labelLayout=function(e,t){return'<div class="form-group col-md-2"><label>'+(t[e]||e)+"</label></div>"},r.checkboxLayout=function(e){return'<div class="form-group col-md-1 text-center"><input type="checkbox" class="icheck" name="search['+e+'][active]" value="1" /></div>'},r[e].apply(this,a)},t.operatorByType={integer:["=","!=",">=","<=","><"],date:["=",">=","<=","><"],string:["~","!~"],"boolean":["!!1","!!0"],list:["=","!="]};var a=function(r,o){var s=e(r),n=this,l=e.extend({isJSON:!1},o||{}),i=[],c=function(t){switch(t){case"body":return e(".box-body",s);case"footer":return e(".box-footer",s);case"searchItemSelector":return e('select[name="searchbox-item-selector"]',s);case"submitBtn":return e("[type=submit]",s);case"form":return e("form",s);case"clearBtn":return e(".searchbox-clear",s)}},u=function(){if(e.hasParam("search")){s.removeClass("collapsed-box");var a,r,o=e.getParam("search");for(a in o)o.hasOwnProperty(a)&&o[a].active>0&&Object.keys(l.params).indexOf(a)>-1&&(r=new t(n,a,l.params[a]),r.setChecked(!0),r.setOperator(o[a].operator),r.setValues(o[a].values))}},d=function(t){t.preventDefault();var a=e(t.currentTarget);return e.ajax({url:c("form").attr("action"),type:"get",data:a.serializeArray(),dataType:"json",success:function(e,t,a){void 0!==l.events.onSuccess&&l.events.onSuccess.call(this,e,t,a)}}),!1},p=function(a){var r,o=e(a.currentTarget),s=o.val();void 0===i[s]&&(r=new t(n,s,l.params[s]),r.setChecked(!0))},m=function(){var e;for(e in i)i.hasOwnProperty(e)&&i[e].destroy()},f=function(){if(void 0===l.params&&void 0!==window.searchBoxParams){var e=JSON.parse(window.searchBoxParams);l.params=e.params,l.url=e.url,l.itemOperators=e.operators,l.itemLabels=e.fieldLabels}void 0!==l.params&&(c("searchItemSelector").append(a.getTemplate("selectOptionsLayout",[{cls:"",name:"",options:l.params},l.itemLabels])),c("searchItemSelector").on("change",p),c("form").attr("action",l.url),c("clearBtn").on("click",m),u()),l.isJSON&&c("form").submit(d)};this.removeItem=function(e){delete i[e],c("searchItemSelector").children('[value="'+e+'"]').attr("disabled",!1)},this.getSettings=function(e){return["itemOperators","itemLabels"].indexOf(e)>-1?l[e]:null},this.getItem=function(e){return i[e]},this.addItem=function(e){c("body").append(e.getElement()),i[e.getId()]=e,c("searchItemSelector").children('[value="'+e.getId()+'"]').attr("disabled",!0)},f()};a.getTemplate=function(e,t){var a={};return a.selectOptionsLayout=function(e,t){var a,r="";for(a in e.options)e.options.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+(t[a]||a)+"</option>");return r},a[e].apply(this,t)},e.fn.searchBox=function(t){return this.each(function(){var r=e(this);if(!r.data("searchBox")){var o=new a(this,t);r.data("searchBox",o)}})}}(jQuery),function(e){"use strict";e.getParams=function(){var e,t,a,r,o=Object.create(null),s=document.location.search.substr(1),n=function(e,t,a){var r,o=t.shift();r=o.match(/\[(.*?)\]/)[1],void 0===e[r]&&(e[r]=[]),t.length>0?n(e[r],t,a):"[]"===o?e.push(a):e[r]=a};if(t=decodeURI(s).split("&"),s.length<1||t.length<1)return o;for(e in t)t.hasOwnProperty(e)&&(a=t[e].split("="),r=a[0].replace(/\[.*?\]/g,""),a[0].search(/\[(.*?)\]/g)>-1?(void 0===o[r]&&(o[r]=[]),n(o[r],a[0].match(/\[(.*?)\]/g),decodeURIComponent(a[1]))):o[a[0]]=decodeURIComponent(a[1]));return o},e.hasParam=function(t){var a=e.getParams();return void 0!==a[t]},e.getParam=function(t){var a=e.getParams();return a[t]||null}}(jQuery);