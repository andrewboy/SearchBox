!function(e){"use strict";var t=function(a,r,s){var o,n=this,l=function(t){switch(t){case"operatorSelect":return e(".operators",o);case"filterVal1":return e(".filter-value-1",o);case"filterVal2":return e(".filter-value-2",o);case"listToggleBtn":return e(".list-toggle",o);case"checkBox":return e("input.icheck",o)}},i=function(t){var a=e(t.currentTarget);switch(a.val()){case"=":case">=":case"<=":case"!":l("filterVal1").css("display","block").attr("disabled",!1),l("filterVal2").css("display","none").attr("disabled",!0);break;case"><":l("filterVal1").css("display","block").attr("disabled",!1),l("filterVal2").css("display","block").attr("disabled",!1)}},c=function(){var t=l("filterVal1");t.is("[multiple]")?(t.attr("size",1).attr("multiple",!1),e(this).removeClass("btn-danger").addClass("btn-primary").children().removeClass("fa-minus").addClass("fa-plus")):(t.attr("size",4).attr("multiple",!0),e(this).addClass("btn-danger").removeClass("btn-primary").children().removeClass("fa-plus").addClass("fa-minus"))},u=function(){window.console.log(s),o=e(t.getTemplate("layout",[r,s,a.getSettings("itemLabels"),a.getSettings("itemOperators")])),a.addItem(n),l("checkBox").iCheck("destroy").iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square"}),l("listToggleBtn").on("click",c),l("operatorSelect").on("change",i),l("operatorSelect").change()};this.getElement=function(){return o},this.getId=function(){return r},this.setOperator=function(e){l("operatorSelect").children('[value="'+e+'"]').prop("selected","selected").trigger("change")},this.setValues=function(e){l("filterVal1").val(e[0]),e.length>1&&l("filterVal2").val(e[1])},this.setVisible=function(e){e?o.removeClass("hidden"):o.addClass("hidden")},this.setChecked=function(e){e?l("checkBox").iCheck("check"):l("checkBox").iCheck("uncheck")},u()};t.getTemplate=function(e,a){var r={};return r.layout=function(e,a,r,s){var o='<div class="row">';return o+=t.getTemplate("checkboxLayout",[e]),o+=t.getTemplate("labelLayout",[e,r]),o+=t.getTemplate("operatorListLayout",[e,a,s]),o+=t.getTemplate("valuesLayout",[e,a]),o+="</div>"},r.valuesLayout=function(e,t){var a,r="",s=t.values&&t.values.length>1;if(r+='<div class="row col-md-7">',"list"===t.type){window.console.log(t.values,t.values.length,s),r+='<div class="form-group col-md-2">',r+="<select "+(s?"multiple":"")+' name="search['+e+'][values][]" class="form-control input-block-level filter-value-1" size="'+(s?4:1)+'">';for(a in t.values)t.values.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+t.values[a]+"</option>");r+="</select>",r+="</div>",r+='<div class="form-group col-md-2"><button type="button" class="btn btn-sm '+(s?"btn-danger":"btn-primary")+' glyphicon list-toggle"><i class="fa fa-'+(s?"minus":"plus")+'"></i></button></div>'}else r+='<div class="form-group col-md-2"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-1" '+("date"===t.type?'data-provide="datepicker" data-date-format="yyyy-mm-dd"':"")+" /></div>",["date","integer"].indexOf(t.type)>-1&&(r+='<div class="form-group col-md-2"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-2" '+("date"===t.type?'data-provide="datepicker"  data-date-format="yyyy-mm-dd"':"")+" /></div>");return r+="</div>"},r.operatorListLayout=function(e,a,r){var s,o;s='<div class="form-group col-md-2"><select name="search['+e+'][operator]" class="form-control  input-block-level operators">';for(o in t.operatorByType[a.type])t.operatorByType[a.type].hasOwnProperty(o)&&(s+='<option value="'+t.operatorByType[a.type][o]+'">'+r[t.operatorByType[a.type][o]]+"</option>");return s+="</select></div>"},r.labelLayout=function(e,t){return'<div class="form-group col-md-2"><label>'+(t[e]||e)+"</label></div>"},r.checkboxLayout=function(e){return'<div class="form-group col-md-1 text-center"><input type="checkbox" class="icheck" name="search['+e+'][search]" value="1" /></div>'},r[e].apply(this,a)},t.operatorByType={integer:["=","!=",">=","<=","><"],date:["=",">=","<=","><"],string:["~","!~"],"boolean":["=","!="],list:["=","!="]};var a=function(r,s){var o=e(r),n=this,l=e.extend({isJSON:!1},s||{}),i=[],c=function(t){switch(t){case"body":return e(".box-body",o);case"footer":return e(".box-footer",o);case"searchItemSelector":return e('select[name="searchbox-item-selector"]',o);case"submitBtn":return e("[type=submit]",o);case"form":return e("form",o)}},u=function(){if(e.hasParam("search")){o.removeClass("collapsed-box"),c("body").css("display","block"),c("footer").css("display","block");var a,r,s=e.getParam("search");for(a in s)s.hasOwnProperty(a)&&s[a].search>0&&Object.keys(l.params).indexOf(a)>-1&&(r=new t(n,a,l.params[a]),r.setChecked(!0))}},d=function(t){t.preventDefault();var a=e(t.currentTarget);return e.ajax({url:c("form").attr("action"),type:"get",data:a.serializeArray(),dataType:"json",success:function(e,t,a){void 0!==l.events.onSuccess&&l.events.onSuccess.call(this,e,t,a)}}),!1},p=function(a){var r,s=e(a.currentTarget),o=s.val();void 0===i[o]&&(r=new t(n,o,l.params[o]),r.setChecked(!0))},m=function(){if(void 0===l.params&&void 0!==window.searchBoxParams){var e=JSON.parse(window.searchBoxParams);l.params=e.params,l.url=e.url,l.itemOperators=e.operators,l.itemLabels=e.fieldLabels}void 0!==l.params&&(c("searchItemSelector").append(a.getTemplate("selectOptionsLayout",[{cls:"",name:"",options:l.params},l.itemLabels])),c("searchItemSelector").on("change",p),c("form").attr("action",l.url),u()),l.isJSON&&c("form").submit(d)};this.getSettings=function(e){return["itemOperators","itemLabels"].indexOf(e)>-1?l[e]:null},this.getItem=function(e){return i[e]},this.addItem=function(e){c("body").append(e.getElement()),i[e.getId()]=e,c("searchItemSelector").children('[value="'+e.getId()+'"]').attr("disabled",!0)},m()};a.getTemplate=function(e,t){var a={};return a.selectOptionsLayout=function(e,t){var a,r="";for(a in e.options)e.options.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+(t[a]||a)+"</option>");return r},a[e].apply(this,t)},e.fn.searchBox=function(t){return this.each(function(){var r=e(this);if(!r.data("searchBox")){var s=new a(this,t);r.data("searchBox",s)}})}}(jQuery),function(e){"use strict";e.getParams=function(){var e,t,a,r,s=Object.create(null),o=document.location.search.substr(1),n=function(e,t,a){var r,s=t.shift();r=s.match(/\[(.*?)\]/)[1],void 0===e[r]&&(e[r]=[]),t.length>0?n(e[r],t,a):"[]"===s?e.push(a):e[r]=a};if(t=decodeURI(o).split("&"),o.length<1||t.length<1)return s;for(e in t)t.hasOwnProperty(e)&&(a=t[e].split("="),r=a[0].replace(/\[.*?\]/g,""),a[0].search(/\[(.*?)\]/g)>-1?(void 0===s[r]&&(s[r]=[]),n(s[r],a[0].match(/\[(.*?)\]/g),decodeURIComponent(a[1]))):s[a[0]]=decodeURIComponent(a[1]));return s},e.hasParam=function(t){var a=e.getParams();return void 0!==a[t]},e.getParam=function(t){var a=e.getParams();return a[t]||null}}(jQuery);