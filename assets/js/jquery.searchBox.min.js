!function(e){"use strict";var t=function(a,r,s){var o,n=this,i=function(t){switch(t){case"operatorSelect":return e(".operators",o);case"filterVal1":return e(".filter-value-1",o);case"filterVal2":return e(".filter-value-2",o);case"listToggleBtn":return e(".list-toggle",o);case"checkBox":return e("input.icheck",o)}},l=function(t){var a=e(t.currentTarget);switch(a.val()){case"=":case">=":case"<=":case"!":i("filterVal1").css("display","block").attr("disabled",!1),i("filterVal2").css("display","none").attr("disabled",!0);break;case"><":i("filterVal1").css("display","block").attr("disabled",!1),i("filterVal2").css("display","block").attr("disabled",!1)}},c=function(){var t=i("filterVal1");t.is("[multiple]")?(t.attr("size",1).attr("multiple",!1),e(this).removeClass("btn-danger").addClass("btn-primary").children().removeClass("fa-minus").addClass("fa-plus")):(t.attr("size",4).attr("multiple",!0),e(this).addClass("btn-danger").removeClass("btn-primary").children().removeClass("fa-plus").addClass("fa-minus"))},u=function(){o=e(t.getTemplate("layout",[r,s,a.getSettings("itemLabels"),a.getSettings("itemOperators")])),a.addItem(n),i("checkBox").iCheck("destroy").iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square"}),i("listToggleBtn").on("click",c),i("operatorSelect").on("change",l),i("operatorSelect").change()};this.getElement=function(){return o},this.getId=function(){return r},this.setOperator=function(e){i("operatorSelect").children('[value="'+e+'"]').prop("selected","selected").trigger("change")},this.setValues=function(e){i("filterVal1").val(e[0]),e.length>1&&i("filterVal2").val(e[1])},this.setVisible=function(e){e?o.removeClass("hidden"):o.addClass("hidden")},this.setChecked=function(e){e?i("checkBox").iCheck("check"):i("checkBox").iCheck("uncheck")},u()};t.getTemplate=function(e,a){var r={};return r.layout=function(e,a,r,s){var o='<div class="row">';return o+=t.getTemplate("checkboxLayout",[e]),o+=t.getTemplate("labelLayout",[e,r]),o+=t.getTemplate("operatorListLayout",[e,a,s]),o+=t.getTemplate("valuesLayout",[e,a]),o+="</div>"},r.valuesLayout=function(e,t){var a,r="";if(r+='<div class="row col-md-7">',"list"===t.type){r+='<div class="form-group col-md-2">',r+='<select name="search['+e+'][values][]" class="form-control input-block-level filter-value-1" size="1">';for(a in t.values)r+='<option value="'+a+'">'+t.values[a]+"</option>";r+="</select>",r+="</div>",r+='<div class="form-group col-md-2"><button type="button" class="btn btn-sm btn-primary glyphicon list-toggle"><i class="fa fa-plus"></i></button></div>'}else r+='<div class="form-group col-md-2"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-1" '+("date"===t.type?'data-provide="datepicker" data-date-format="yyyy-mm-dd"':"")+" /></div>",["date","integer"].indexOf(t.type)>-1&&(r+='<div class="form-group col-md-2"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-2" '+("date"===t.type?'data-provide="datepicker"  data-date-format="yyyy-mm-dd"':"")+" /></div>");return r+="</div>"},r.operatorListLayout=function(e,a,r){var s,o;s='<div class="form-group col-md-2"><select name="search['+e+'][operator]" class="form-control  input-block-level operators">';for(o in t.operatorByType[a.type])s+='<option value="'+t.operatorByType[a.type][o]+'">'+r[t.operatorByType[a.type][o]]+"</option>";return s+="</select></div>"},r.labelLayout=function(e,t){return'<div class="form-group col-md-2"><label>'+(t[e]||e)+"</label></div>"},r.checkboxLayout=function(e){return'<div class="form-group col-md-1 text-center"><input type="checkbox" class="icheck" name="search['+e+'][search]" value="1" /></div>'},r[e].apply(this,a)},t.operatorByType={integer:["=","!=",">=","<=","><"],date:["=",">=","<=","><"],string:["~","!~"],"boolean":["=","!="],list:["=","!="]};var a=function(r,s){var o=e(r),n=this,i=e.extend({isJSON:!1},s||{}),l=[],c=function(t){switch(t){case"body":return e(".box-body",o);case"footer":return e(".box-footer",o);case"searchItemSelector":return e('select[name="searchbox-item-selector"]',o);case"submitBtn":return e("[type=submit]",o);case"form":return e("form",o)}},u=function(){if(e.hasParam("search")){o.removeClass("collapsed-box"),c("body").css("display","block"),c("footer").css("display","block");var a=e.getParam("search");for(var r in a)if(a[r].search>0&&Object.keys(i.params).indexOf(r)>-1){var s=new t(n,r,i.params[r]);s.setChecked(!0),s.setOperator(a[r].operator),s.setValues(a[r].values)}}},d=function(){if("undefined"==typeof i.params&&"undefined"!=typeof window.searchBoxParams){var e=JSON.parse(window.searchBoxParams);i.params=e.params,i.url=e.url,i.itemOperators=e.operators,i.itemLabels=e.fieldLabels}"undefined"!=typeof i.params&&(c("searchItemSelector").append(a.getTemplate("selectOptionsLayout",[{cls:"",name:"",options:i.params},i.itemLabels])),c("searchItemSelector").on("change",f),c("form").attr("action",i.url),u()),i.isJSON&&c("form").submit(p)},p=function(t){t.preventDefault();var a=e(t.currentTarget);return e.ajax({url:c("form").attr("action"),type:"get",data:a.serializeArray(),dataType:"json",success:function(e,t,a){"undefined"!=i.events.onSuccess&&i.events.onSuccess.call(this,e,t,a)}}),!1},f=function(a){var r=e(a.currentTarget),s=r.val();if("undefined"==typeof l[s]){var o=new t(n,s,i.params[s]);o.setChecked(!0)}};this.getSettings=function(e){return["itemOperators","itemLabels"].indexOf(e)>-1?i[e]:null},this.getItem=function(e){return l[e]},this.addItem=function(e){c("body").append(e.getElement()),l[e.getId()]=e,c("searchItemSelector").children('[value="'+e.getId()+'"]').attr("disabled",!0)},d()};a.getTemplate=function(e,t){var a={};return a.selectOptionsLayout=function(e,t){var a="";for(var r in e.options)a+='<option value="'+r+'">'+(t[r]||r)+"</option>";return a},a[e].apply(this,t)},e.fn.searchBox=function(t){return this.each(function(){var r=e(this);if(!r.data("searchBox")){var s=new a(this,t);r.data("searchBox",s)}})}}(jQuery),function(e){"use strict";e.getParams=function(){var e=Object.create(null),t=function(e,a,r){var s=a.shift(),o=s.match(/\[(.*?)\]/)[1];"undefined"==typeof e[o]&&(e[o]=[]),a.length>0?t(e[o],a,r):"[]"===s?e.push(r):e[o]=r},a=document.location.search.substr(1),r=decodeURI(a).split("&");if(a.length<1||r.length<1)return e;for(var s in r){var o=r[s].split("="),n=o[0].replace(/\[.*?\]/g,"");o[0].search(/\[(.*?)\]/g)>-1?("undefined"==typeof e[n]&&(e[n]=[]),t(e[n],o[0].match(/\[(.*?)\]/g),decodeURIComponent(o[1]))):e[o[0]]=decodeURIComponent(o[1])}return e},e.hasParam=function(t){var a=e.getParams();return"undefined"!=typeof a[t]},e.getParam=function(t){var a=e.getParams();return a[t]||null}}(jQuery);