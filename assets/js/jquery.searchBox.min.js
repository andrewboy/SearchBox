!function(e){"use strict";var t=function(a,r,o){var s,i=this,n=function(t){switch(t){case"operatorSelect":return e(".operators",s);case"filterVal1":return e(".filter-value-1",s);case"filterVal2":return e(".filter-value-2",s);case"listToggleBtn":return e(".list-toggle",s);case"checkBox":return e("input.searchbox-icheck",s)}},c=function(t){var a=e(t.currentTarget);switch(a.val()){case"=":case">=":case"<=":case"!":n("filterVal1").css("display","block").attr("disabled",!1),n("filterVal2").css("display","none").attr("disabled",!0);break;case"><":n("filterVal1").css("display","block").attr("disabled",!1),n("filterVal2").css("display","block").attr("disabled",!1)}},l=function(e){var t=n("filterVal1");e?(t.attr("size",4).attr("multiple",!0),n("listToggleBtn").addClass("btn-danger").removeClass("btn-primary").children().removeClass("fa-plus").addClass("fa-minus")):(t.attr("size",1).attr("multiple",!1),n("listToggleBtn").removeClass("btn-danger").addClass("btn-primary").children().removeClass("fa-minus").addClass("fa-plus"))},u=function(){l(!n("filterVal1").is("[multiple]"))},d=function(){s=e(t.getTemplate("layout",[r,o,a.getSettings("itemLabels"),a.getSettings("itemOperators")])),a.addItem(i),n("checkBox").iCheck("destroy").iCheck({checkboxClass:"icheckbox_square",radioClass:"iradio_square"}).on("ifToggled",function(e){a.itemActivationChange(i)}),n("listToggleBtn").on("click",u),n("operatorSelect").on("change",c),n("operatorSelect").change()};this.destroy=function(){s.remove(),o=void 0,a.removeItem(r)},this.getElement=function(){return s},this.getId=function(){return r},this.getType=function(){return o.type},this.setOperator=function(e){n("operatorSelect").children('[value="'+e+'"]').prop("selected","selected").trigger("change")},this.setValues=function(e){"list"===o.type&&e.length>1?(l(!0),n("filterVal1").val(e)):(n("filterVal1").val(e[0]),e.length>1&&n("filterVal2").val(e[1]))},this.setVisible=function(e){e?s.removeClass("hidden"):s.addClass("hidden")},this.setChecked=function(e){e?n("checkBox").iCheck("check"):n("checkBox").iCheck("uncheck")},this.isActive=function(){return n("checkBox").is(":checked")},d()};t.getTemplate=function(e,a){var r={};return r.layout=function(e,a,r,o){var s='<div class="row">';return s+=t.getTemplate("checkboxLayout",[e]),s+=t.getTemplate("labelLayout",[e,r]),s+=t.getTemplate("operatorListLayout",[e,a,o]),s+=t.getTemplate("valuesLayout",[e,a]),s+="</div>"},r.valuesLayout=function(e,t){var a,r="";if(r+='<div class="row col-md-7">',"list"===t.type){r+='<div class="form-group col-md-4">',r+='<select name="search['+e+'][values][]" class="form-control input-block-level filter-value-1" size="1">';for(a in t.values)t.values.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+t.values[a]+"</option>");r+="</select>",r+="</div>",r+='<div class="form-group col-md-2"><button type="button" class="btn btn-sm btn-primary glyphicon list-toggle"><i class="fa fa-plus"></i></button></div>'}else"boolean"===t.type?r+='<div class="form-group col-md-4"><input type="hidden" value="1" name="search['+e+'][values][]" /></div>':(r+='<div class="form-group col-md-4"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-1" '+("date"===t.type?'data-provide="datepicker" data-date-format="yyyy-mm-dd"':"")+" /></div>",["date","integer"].indexOf(t.type)>-1&&(r+='<div class="form-group col-md-4"><input type="text" value="" name="search['+e+'][values][]" placeholder="" class="form-control filter-value-2" '+("date"===t.type?'data-provide="datepicker"  data-date-format="yyyy-mm-dd"':"")+" /></div>"));return r+="</div>"},r.operatorListLayout=function(e,a,r){var o,s;o='<div class="form-group col-md-2"><select name="search['+e+'][operator]" class="form-control  input-block-level operators">';for(s in t.operatorByType[a.type])t.operatorByType[a.type].hasOwnProperty(s)&&(o+='<option value="'+t.operatorByType[a.type][s]+'">'+r[t.operatorByType[a.type][s]]+"</option>");return o+="</select></div>"},r.labelLayout=function(e,t){return'<div class="form-group col-md-2"><label>'+(t[e]||e)+"</label></div>"},r.checkboxLayout=function(e){return'<div class="form-group col-md-1 text-center"><input type="checkbox" class="searchbox-icheck" name="search['+e+'][active]" value="1" /></div>'},r[e].apply(this,a)},t.operatorByType={integer:["=","!=",">=","<=","><"],date:["=",">=","<=","><"],string:["~","!~"],"boolean":["!!1","!!0"],list:["=","!="]};var a=function(r,o){var s=e(r),i=this,n=e.extend({isJSON:!1,itemBeforeInit:function(){},itemAfterInit:function(e){}},o||{}),c=[],l=function(t){switch(t){case"body":return e(".box-body",s);case"footer":return e(".box-footer",s);case"searchItemSelector":return e('select[name="searchbox-item-selector"]',s);case"submitBtn":return e("[type=submit]",s);case"form":return e("form",s);case"clearBtn":return e(".searchbox-clear",s)}},u=function(){if(e.hasParam("search")){s.removeClass("collapsed-box");var a,r,o=e.getParam("search");for(a in o)o.hasOwnProperty(a)&&o[a].active>0&&Object.keys(n.params).indexOf(a)>-1&&(r=new t(i,a,n.params[a]),r.setChecked(!0),r.setOperator(o[a].operator),r.setValues(o[a].values))}},d=function(t){t.preventDefault();var a=e(t.currentTarget);return e.ajax({url:l("form").attr("action"),type:"get",data:a.serializeArray(),dataType:"json",success:function(e,t,a){void 0!==n.events.onSuccess&&n.events.onSuccess.call(this,e,t,a)}}),!1},p=function(a){var r,o=e(a.currentTarget),s=o.val();void 0===c[s]&&(n.itemBeforeInit.call(this),r=new t(i,s,n.params[s]),r.setChecked(!0),n.itemAfterInit.call(this,r))},h=function(){var e;for(e in c)c.hasOwnProperty(e)&&c[e].destroy();n.options.is_cached&&Cookies.set("searchbox_is_cleared","1")},m=function(){if(void 0===n.params&&void 0!==window.searchBoxParams){var e=JSON.parse(window.searchBoxParams);n.params=e.params,n.url=e.url,n.options=e.options,n.itemOperators=e.operators,n.itemLabels=e.fieldLabels}void 0!==n.params&&(l("searchItemSelector").append(a.getTemplate("selectOptionsLayout",[{cls:"",name:"",options:n.params},n.itemLabels])),l("searchItemSelector").on("change",p),l("form").attr("action",n.url),l("clearBtn").on("click",h),u()),n.isJSON&&l("form").submit(d)};this.removeItem=function(e){delete c[e],l("searchItemSelector").children('[value="'+e+'"]').attr("disabled",!1),n.options.is_cached&&(c.length>0?Cookies.remove("searchbox_is_cleared"):Cookies.set("searchbox_is_cleared","1"))},this.getSettings=function(e){return["itemOperators","itemLabels"].indexOf(e)>-1?n[e]:null},this.getItem=function(e){return c[e]},this.addItem=function(e){l("body").append(e.getElement()),c[e.getId()]=e,l("searchItemSelector").children('[value="'+e.getId()+'"]').attr("disabled",!0),Cookies.remove("searchbox_is_cleared")},this.itemActivationChange=function(e){if(n.options.is_cached){var t,a=!0;for(t in c)if(c.hasOwnProperty(t)&&c[t].isActive()){a=!1;break}a?Cookies.set("searchbox_is_cleared","1"):Cookies.remove("searchbox_is_cleared")}},m()};a.getTemplate=function(e,t){var a={};return a.selectOptionsLayout=function(e,t){var a,r="";for(a in e.options)e.options.hasOwnProperty(a)&&(r+='<option value="'+a+'">'+(t[a]||a)+"</option>");return r},a[e].apply(this,t)},e.fn.searchBox=function(t){return this.each(function(){var r=e(this);if(!r.data("searchBox")){var o=new a(this,t);r.data("searchBox",o)}})}}(jQuery),function(e){"use strict";e.getParams=function(){var e,t,a,r,o=Object.create(null),s=document.location.search.substr(1).replace(/\+/g,"%20"),i=function(e,t,a){var r,o=t.shift();r=o.match(/\[(.*?)\]/)[1],void 0===e[r]&&("[]"===t[0]?e[r]=[]:e[r]={}),"[]"===t[0]&&(o=t.shift()),t.length>0?i(e[r],t,a):"[]"===o?e[r].push(a):e[r]=a};if(t=decodeURI(s).split("&"),s.length<1||t.length<1)return o;for(e in t)t.hasOwnProperty(e)&&(a=t[e].split("="),r=a[0].replace(/\[.*?\]/g,""),a[0].search(/\[(.*?)\]/g)>-1?(void 0===o[r]&&(o[r]={}),i(o[r],a[0].match(/\[(.*?)\]/g),decodeURIComponent(a[1]))):o[a[0]]=decodeURIComponent(a[1]));return o},e.hasParam=function(t){var a=e.getParams();return void 0!==a[t]},e.getParam=function(t){var a=e.getParams();return a[t]||null}}(jQuery);